{"version":3,"file":"writeStoriesJSFile.js","sourceRoot":"","sources":["../../server/writeStoriesJSFile.ts"],"names":[],"mappings":";;;;;;AAAA,0CAAoB;AACpB,8CAAwB;AAGxB,mCAA0D;AAE1D,SAAS,kBAAkB,CAAC,YAA0B;IACpD,IAAM,OAAO,GAAG,mBAAU,CAAC,YAAY,CAAC,CAAC;IAEzC,IAAI,QAAQ,GAAG,+CAET,kBAAkB,CAAC,OAAO,CAAC,mDAE9B,CAAC;IAEJ,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE;QAC3B,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC,aAAa,CAAC,QAAQ,EAAE;YACpD,MAAM,EAAE,IAAI;SACb,CAAC,CAAC,IAAI,CAAC;KACT;IAED,IAAM,UAAU,GAAG,2BAAkB,CAAC,YAAY,CAAC,CAAC;IACpD,IAAM,iBAAiB,GAAG,cAAI,CAAC,OAAO,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;IACjE,YAAE,CAAC,aAAa,CAAC,iBAAiB,EAAE,QAAQ,EAAE,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC;AACvE,CAAC;AA0CQ,gDAAkB;AAxC3B,SAAS,kBAAkB,CAAC,OAA4B;IACtD,OAAO,OAAO;SACX,GAAG,CAAC,UAAA,KAAK;QACR,IAAM,YAAY,GAAG,KAAK,CAAC,YAAY;aACpC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC;aAC3B,KAAK,CAAC,GAAG,CAAC;aACV,GAAG,EAAE,CAAC;QAET,OAAO,0BACQ,KAAK,CAAC,EAAE,yDACU,KAAK,CAAC,QAAQ,qGAEpB,KAAK,CAAC,EAAE,oEACiB,YAAY,0NAMnC,KAAK,CAAC,EAAE,iYAe/B,KAAK,CAAC,EAAE,sBACX,CAAC;IACN,CAAC,CAAC;SACD,IAAI,CAAC,IAAI,CAAC,CAAC;AAChB,CAAC","sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nimport { ServerConfig, StoryManifestItem } from '../types';\nimport { getStories, getStoriesCacheDir } from './shared';\n\nfunction writeStoriesJSFile(serverConfig: ServerConfig) {\n  const stories = getStories(serverConfig);\n\n  let template = `\n      const storiesToExport = {}\n      ${writeStoryRequires(stories)}\n      module.exports = storiesToExport\n    `;\n\n  if (!process.env.EXPO_DEBUG) {\n    template = require('esbuild').transformSync(template, {\n      minify: true,\n    }).code;\n  }\n\n  const storiesDir = getStoriesCacheDir(serverConfig);\n  const writeRequiresPath = path.resolve(storiesDir, 'stories.js');\n  fs.writeFileSync(writeRequiresPath, template, { encoding: 'utf-8' });\n}\n\nfunction writeStoryRequires(stories: StoryManifestItem[]) {\n  return stories\n    .map(story => {\n      const defaultTitle = story.relativePath\n        .replace('.stories.tsx', '')\n        .split('/')\n        .pop();\n\n      return `\n          function ${story.id}Setup() {\n            const stories = require(\"${story.fullPath}\")\n            const parentConfig = stories.default || {}\n            parentConfig.id = \"${story.id}\"\n            parentConfig.title = parentConfig.title || '${defaultTitle}'\n\n            Object.keys(stories).forEach((key) => {\n              const Component = stories[key]\n              \n              if (typeof Component === \"function\") {\n                const storyId = \"${story.id}\" + \"_\" + key\n                \n                Component.storyConfig = {\n                  id: storyId,\n                  name: key,\n                  ...Component.storyConfig,\n                }\n\n                Component.parentConfig = parentConfig\n\n                storiesToExport[storyId] = Component \n              }\n            })\n          }\n\n          ${story.id}Setup()\n        `;\n    })\n    .join('\\n');\n}\n\nexport { writeStoriesJSFile };\n"]}